<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MRI Brain Tumor Diagnosis</title>
  
  <!-- Tailwind CSS with Dark Mode Config -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class', // Enable manual dark mode toggling
    }
  </script>
  
  <!-- Google Fonts: Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent; 
    }
    ::-webkit-scrollbar-thumb {
      background: #cbd5e1; 
      border-radius: 4px;
    }
    .dark ::-webkit-scrollbar-thumb {
      background: #475569; 
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .spinner {
      border: 3px solid rgba(255,255,255,0.4);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 1s ease-in-out infinite;
    }
  </style>
</head>
<!-- Body background adapts to dark mode -->
<body class="min-h-screen flex items-center justify-center p-4 transition-colors duration-300 bg-slate-50 dark:bg-slate-950 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-white via-slate-50 to-slate-100 dark:from-slate-900 dark:via-slate-950 dark:to-black">

  <!-- Main Card Container -->
  <div class="w-full max-w-lg bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl shadow-xl overflow-hidden relative transition-colors duration-300">
    
    <!-- Top Accent Line -->
    <div class="h-1.5 w-full bg-gradient-to-r from-blue-500 to-teal-400"></div>

    <!-- Theme Toggle Button (Absolute Position) -->
    <button id="themeToggle" class="absolute top-4 right-4 p-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors focus:outline-none" aria-label="Toggle Dark Mode">
      <!-- Sun Icon (shown in dark mode) -->
      <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
      <!-- Moon Icon (shown in light mode) -->
      <i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i>
    </button>

    <div class="p-8">
      
      <!-- Header -->
      <div class="mb-8 text-center">
        <div class="inline-flex items-center justify-center p-3 bg-blue-50 dark:bg-slate-800 rounded-xl mb-4 shadow-sm border border-blue-100 dark:border-slate-700 transition-colors">
          <i data-lucide="activity" class="w-8 h-8 text-blue-600 dark:text-blue-400"></i>
        </div>
        <h1 class="text-2xl font-bold text-slate-900 dark:text-white tracking-tight transition-colors">Brain Tumor Detection</h1>
        <p class="text-slate-500 dark:text-slate-400 text-sm mt-2 transition-colors">AI-Powered MRI Analysis & Diagnostic Tool</p>
      </div>

      <!-- Upload Area -->
      <label id="uploadArea" class="group relative flex flex-col items-center justify-center w-full h-48 rounded-xl border-2 border-dashed border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 hover:bg-blue-50/50 dark:hover:bg-slate-800 hover:border-blue-400 dark:hover:border-blue-500 transition-all cursor-pointer overflow-hidden">
        
        <!-- Default State -->
        <div class="flex flex-col items-center justify-center pt-5 pb-6 text-center z-10 transition-opacity duration-300" id="uploadPlaceholder">
          <div class="p-3 bg-white dark:bg-slate-700 rounded-full shadow-sm mb-3 group-hover:scale-110 transition-transform duration-300 border border-slate-100 dark:border-slate-600">
            <i data-lucide="upload-cloud" class="w-6 h-6 text-blue-500 dark:text-blue-400"></i>
          </div>
          <p class="mb-1 text-sm text-slate-700 dark:text-slate-300 font-medium">Click to upload or drag & drop</p>
          <p class="text-xs text-slate-400 dark:text-slate-500">DICOM, JPEG, PNG (Max 10MB)</p>
        </div>

        <!-- Image Preview -->
        <img id="previewImage" class="absolute inset-0 w-full h-full object-contain bg-slate-100 dark:bg-black hidden p-2" alt="MRI Scan Preview" />
        
        <input id="imageInput" type="file" class="hidden" accept="image/*" />
      </label>

      <!-- Status Text -->
      <div id="statusText" class="mt-4 text-center text-sm min-h-[20px] transition-colors"></div>

      <!-- Action Buttons -->
      <div class="flex gap-3 mt-6">
        <!-- Primary -->
        <button id="predictBtn" disabled class="flex-1 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-500 text-white font-semibold py-2.5 px-4 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md shadow-blue-200 dark:shadow-blue-900/20">
          <span id="btnIcon"><i data-lucide="scan-line" class="w-4 h-4"></i></span>
          <span id="btnText">Analyze Scan</span>
        </button>
        
        <!-- Secondary -->
        <button id="clearBtn" class="flex items-center justify-center gap-2 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 font-medium py-2.5 px-4 rounded-lg transition-all shadow-sm">
          <i data-lucide="trash-2" class="w-4 h-4"></i>
        </button>
      </div>

      <!-- Result Section -->
      <div id="resultCard" class="hidden mt-6 animate-fade-in">
        <div class="bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-xl p-6 transition-colors">
          <div class="flex items-center justify-between mb-6">
            <span class="text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400">Diagnosis Result</span>
            <span class="text-xs font-mono text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/30 px-2 py-0.5 rounded border border-blue-200 dark:border-blue-800">API: /predict</span>
          </div>
          
          <!-- Centered Content -->
          <div class="flex flex-col items-center justify-center text-center mb-6">
            <div class="p-4 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-full shadow-sm mb-3 transition-colors">
              <i data-lucide="brain-circuit" class="w-10 h-10 text-teal-500 dark:text-teal-400"></i>
            </div>
            <div class="w-full">
              <h3 id="resultDisease" class="text-3xl font-bold text-slate-900 dark:text-white leading-tight mb-1 transition-colors">—</h3>
              <p class="text-sm text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wide mb-4">Classification</p>
              
              <!-- New Description Section (Left Aligned) -->
              <div class="w-full text-left px-4 py-3 bg-white dark:bg-slate-900/50 rounded-lg border border-slate-100 dark:border-slate-800 shadow-sm">
                <p id="resultDescription" class="text-sm leading-relaxed text-slate-600 dark:text-slate-300">
                  <!-- Description will be inserted here by JS -->
                </p>
              </div>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="space-y-2">
            <div class="flex justify-between text-xs mb-1">
              <span class="text-slate-500 dark:text-slate-400 font-medium">Confidence Score</span>
              <span id="confidenceText" class="text-slate-900 dark:text-white font-bold font-mono">0%</span>
            </div>
            <div class="w-full bg-slate-200 dark:bg-slate-800 rounded-full h-3 overflow-hidden transition-colors">
              <div id="confidenceFill" class="bg-gradient-to-r from-blue-500 to-teal-400 h-3 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
    
    <!-- Footer -->
    <div class="px-8 py-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-800 text-center transition-colors">
      <div class="flex items-center justify-center gap-2 text-xs text-slate-400 dark:text-slate-500">
        <i data-lucide="shield-check" class="w-3 h-3"></i>
        <span>HIPAA Compliant UI • Secure Processing</span>
      </div>
    </div>
  </div>

<script>
  // Initialize Icons
  lucide.createIcons();

  // Elements
  const themeToggle = document.getElementById('themeToggle');
  const uploadArea = document.getElementById('uploadArea');
  const imageInput = document.getElementById('imageInput');
  const previewImage = document.getElementById('previewImage');
  const uploadPlaceholder = document.getElementById('uploadPlaceholder');
  const predictBtn = document.getElementById('predictBtn');
  const clearBtn = document.getElementById('clearBtn');
  const statusText = document.getElementById('statusText');
  const resultCard = document.getElementById('resultCard');
  const resultDisease = document.getElementById('resultDisease');
  const resultDescription = document.getElementById('resultDescription');
  const confidenceFill = document.getElementById('confidenceFill');
  const confidenceText = document.getElementById('confidenceText');
  const btnText = document.getElementById('btnText');
  const btnIcon = document.getElementById('btnIcon');

  // Disease Information Database
  const diseaseInfo = {
    'glioma': {
      text: "Gliomas arise from glial cells and can infiltrate surrounding brain tissue.",
      impact: "High-grade gliomas are aggressive and can cause seizures, headaches, and cognitive decline due to rapid pressure increase in the skull."
    },
    'meningioma': {
      text: "Meningiomas grow from the membranes surrounding the brain and spinal cord. They are often slow-growing.",
      impact: "While usually benign, large meningiomas can compress adjacent brain structures, leading to focal neurological deficits or seizures."
    },
    'pituitary': {
      text: "Pituitary tumors develop in the pituitary gland at the base of the brain, regulating hormones.",
      impact: "They may disrupt hormone balance causing systemic issues, or compress the optic chiasm leading to visual field defects."
    },
    'notumor': {
      text: "No pathological abnormalities resembling a tumor were detected in this MRI scan.",
      impact: "The scan appears healthy based on the model's training parameters."
    },
    'unknown': {
      text: "The detected pattern does not match known tumor classes with high certainty.",
      impact: "Please consult a medical professional for a detailed manual review."
    }
  };

  // Theme Logic
  const toggleTheme = () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }

  themeToggle.addEventListener('click', toggleTheme);

  // Helper: Set Status Message
  const setStatus = (msg, type = 'normal') => {
    statusText.textContent = msg;
    statusText.className = 'mt-4 text-center text-sm font-medium transition-colors duration-200 min-h-[20px]';
    if (type === 'error') statusText.classList.add('text-red-500', 'dark:text-red-400');
    else if (type === 'success') statusText.classList.add('text-teal-600', 'dark:text-teal-400');
    else statusText.classList.add('text-slate-500', 'dark:text-slate-400');
  };

  // Helper: Reset UI
  const resetUI = () => {
    imageInput.value = '';
    previewImage.src = '';
    previewImage.classList.add('hidden');
    uploadPlaceholder.classList.remove('hidden');
    
    predictBtn.disabled = true;
    setStatus('');
    
    resultCard.classList.add('hidden');
    confidenceFill.style.width = '0%';
    confidenceText.textContent = '0%';
    resultDisease.textContent = '—';
    resultDescription.textContent = '';
  };

  // Drag & Drop Interactions
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    uploadArea.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ['dragenter', 'dragover'].forEach(eventName => {
    uploadArea.addEventListener(eventName, highlight, false);
  });

  ['dragleave', 'drop'].forEach(eventName => {
    uploadArea.addEventListener(eventName, unhighlight, false);
  });

  function highlight() {
    uploadArea.classList.add('border-blue-400', 'bg-blue-50/30', 'dark:border-blue-500', 'dark:bg-slate-800');
  }

  function unhighlight() {
    uploadArea.classList.remove('border-blue-400', 'bg-blue-50/30', 'dark:border-blue-500', 'dark:bg-slate-800');
  }

  uploadArea.addEventListener('drop', handleDrop, false);

  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    if (files && files[0]) handleFiles(files[0]);
  }

  imageInput.addEventListener('change', function() {
    if (this.files && this.files[0]) handleFiles(this.files[0]);
  });

  function handleFiles(file) {
    if (!file.type.startsWith('image/')) {
      setStatus('Invalid file format. Please upload an MRI image.', 'error');
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      previewImage.src = e.target.result;
      previewImage.classList.remove('hidden');
      uploadPlaceholder.classList.add('hidden');
      predictBtn.disabled = false;
      setStatus('Image ready for analysis.', 'normal');
      resultCard.classList.add('hidden');
    };
    reader.readAsDataURL(file);
    
    if (imageInput.files[0] !== file) {
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        imageInput.files = dataTransfer.files;
    }
  }

  predictBtn.addEventListener('click', async () => {
    if (!imageInput.files[0]) return;

    predictBtn.disabled = true;
    const originalBtnText = btnText.textContent;
    const originalBtnIcon = btnIcon.innerHTML;
    
    btnText.textContent = 'Processing...';
    btnIcon.innerHTML = '<div class="spinner w-4 h-4"></div>';
    setStatus('Sending data to neural network...', 'normal');
    
    const formData = new FormData();
    formData.append('image', imageInput.files[0]);

    try {
      const response = await fetch('/predict', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) throw new Error(`Server Error: ${response.status}`);

      const data = await response.json();
      
      const label = data.label || 'Unknown Anomaly';
      const confidence = data.confidence || 0;
      
      resultDisease.textContent = label;
      
      // Update Description based on label
      const normalizedLabel = label.toLowerCase().replace(/\s/g, '');
      const info = diseaseInfo[normalizedLabel] || diseaseInfo['unknown'];
      resultDescription.innerHTML = `<span class="font-semibold text-slate-700 dark:text-slate-200">Description:</span> ${info.text}<br><br><span class="font-semibold text-red-500 dark:text-red-400">Impact:</span> ${info.impact}`;

      const percent = (confidence * 100).toFixed(1);
      confidenceText.textContent = `${percent}%`;
      
      resultCard.classList.remove('hidden');
      
      setTimeout(() => {
        confidenceFill.style.width = `${percent}%`;
      }, 100);

      setStatus('Analysis complete.', 'success');

    } catch (error) {
      console.error(error);
      setStatus('Connection failed. Ensure API is running.', 'error');
    } finally {
      predictBtn.disabled = false;
      btnText.textContent = originalBtnText;
      btnIcon.innerHTML = originalBtnIcon;
      lucide.createIcons();
    }
  });

  clearBtn.addEventListener('click', resetUI);

</script>
</body>
</html>